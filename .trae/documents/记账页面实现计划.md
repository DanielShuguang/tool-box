# 记账页面实现计划

## 功能规划

### 基础功能
1. **收支记录**：
   - 金额输入
   - 收支类型选择（收入/支出）
   - 分类管理（可预设常用分类，如餐饮、交通、工资等）
   - 日期选择
   - 备注添加

2. **收支列表**：
   - 按时间倒序展示
   - 支持基本筛选（收入/支出/全部）
   - 每条记录显示完整信息
   - 支持删除记录

3. **数据统计**：
   - 简单的收支统计（今日/本月）
   - 基本图表展示（可选，使用轻量级图表库）

4. **数据持久化**：
   - 优先使用IndexedDB存储
   - 不支持时降级到Tauri store
   - 通过DIP原则统一存储接口

### 扩展性设计
1. **模块化架构**：
   - 将核心逻辑与UI分离，便于后续扩展
   - 使用Composition API实现逻辑复用

2. **可扩展的数据模型**：
   - 设计灵活的数据结构，支持后续添加标签、账户等字段
   - 分类系统支持自定义和扩展

3. **组件化设计**：
   - 将页面拆分为多个小组件，便于维护和扩展
   - 预留统计组件接口，支持后续添加更复杂的统计功能

4. **API预留**：
   - 设计清晰的store接口，支持后续添加导入/导出功能
   - 预留与后端交互的接口，便于后续接入云端同步

## 实现步骤

1. **设计统一存储接口**：
   - 创建`src/utils/storage`目录
   - 定义统一的存储接口（DIP原则）
   - 实现IndexedDB适配器
   - 实现Tauri store适配器
   - 实现存储工厂，根据环境自动选择合适的存储方式

2. **创建路由配置**：
   - 在`src/router/index.ts`中添加记账页面路由

3. **创建页面组件**：
   - 在`src/views/`下创建`Accounting`目录
   - 创建`Accounting.vue`主组件
   - 创建`logic.ts`逻辑文件

4. **创建状态管理**：
   - 在`src/stores/`下创建`accounting.ts`
   - 使用统一存储接口进行数据持久化
   - 设计数据结构和操作方法

5. **实现核心功能**：
   - 收支记录表单
   - 收支列表展示
   - 基本统计功能

6. **样式和交互优化**：
   - 使用Naive UI组件库
   - 应用UnoCSS样式
   - 添加基本动画效果

## 技术栈
- Vue 3 + TypeScript
- Naive UI
- Pinia（含持久化）
- Vue Router
- UnoCSS
- IndexedDB（优先）
- Tauri Store（降级方案）

## 文件结构
```
src/
├── views/
│   └── Accounting/
│       ├── Accounting.vue    # 主页面组件
│       └── logic.ts           # 业务逻辑
├── stores/
│   └── accounting.ts          # 状态管理
├── router/
│   └── index.ts               # 路由配置
└── utils/
    └── storage/
        ├── index.ts           # 存储入口和工厂
        ├── interface.ts       # 统一存储接口定义
        ├── indexeddb.ts       # IndexedDB适配器
        └── tauri-store.ts     # Tauri Store适配器
```

## 统一存储接口设计

```typescript
// 统一存储接口
export interface StorageAdapter {
  // 初始化存储
  init(): Promise<void>;
  
  // 保存数据
  save<T>(key: string, value: T): Promise<void>;
  
  // 加载数据
  load<T>(key: string, defaultValue: T): Promise<T>;
  
  // 删除数据
  remove(key: string): Promise<void>;
  
  // 清空存储
  clear(): Promise<void>;
  
  // 获取所有键
  keys(): Promise<string[]>;
}

// 存储工厂函数
export function createStorageAdapter(): StorageAdapter {
  // 检测环境，优先使用IndexedDB
  if (typeof window !== 'undefined' && 'indexedDB' in window) {
    return new IndexedDBAdapter();
  }
  // 降级到Tauri Store
  return new TauriStoreAdapter();
}
```

## 数据模型设计

```typescript
// 记账记录接口
export interface AccountingRecord {
  id: string;                 // 唯一标识
  amount: number;             // 金额
  type: 'income' | 'expense'; // 类型
  category: string;           // 分类
  date: number;               // 时间戳
  note?: string;              // 备注
}

// 分类接口
export interface Category {
  id: string;
  name: string;
  type: 'income' | 'expense';
  icon?: string;
}
```

## 扩展性考虑
1. 数据模型预留了`icon`字段，支持后续添加分类图标
2. 记录模型预留了扩展字段，便于添加标签、账户等信息
3. 逻辑层与UI层分离，支持后续替换或增强统计功能
4. 状态管理设计支持批量操作，便于后续添加导入功能
5. 组件化设计便于后续添加更多视图（如日历视图、图表视图）
6. 统一存储接口支持后续添加更多存储适配器（如云端存储）
7. 存储工厂设计支持后续添加存储策略，如加密存储、压缩存储等