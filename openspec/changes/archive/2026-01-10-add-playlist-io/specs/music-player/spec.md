## 新增需求

### 需求：导出播放列表

系统必须提供将当前播放列表导出到本地文件的功能，支持JSON、M3U8和PLS三种格式。

#### 场景：导出为JSON格式
- **当** 用户选择导出当前播放列表为JSON格式
- **并且** 选择保存路径和文件名
- **那么** 系统必须生成包含完整播放列表信息的JSON文件
- **并且** 文件必须包含版本号、导出时间、播放列表名称和所有歌曲的元数据
- **并且** 歌曲路径必须使用绝对路径

#### 场景：导出为M3U8格式
- **当** 用户选择导出当前播放列表为M3U8格式
- **并且** 选择保存路径和文件名
- **那么** 系统必须生成符合M3U8标准的文本文件
- **并且** 文件必须包含 `#EXTM3U` 头和 `#EXTINF` 元信息行
- **并且** 每首歌曲必须包含时长和标题信息

#### 场景：导出为PLS格式
- **当** 用户选择导出当前播放列表为PLS格式
- **并且** 选择保存路径和文件名
- **那么** 系统必须生成符合PLS标准的INI格式文件
- **并且** 文件必须包含 `[playlist]` 段和歌曲条目数
- **并且** 每首歌曲必须包含 `FileN`、`TitleN` 和 `LengthN` 字段

#### 场景：导出成功提示
- **当** 播放列表导出成功
- **那么** 系统必须显示成功消息，包含播放列表名称和保存路径

#### 场景：导出失败处理
- **当** 导出过程中发生错误（磁盘空间不足、权限不足等）
- **那么** 系统必须显示错误消息，说明失败原因

---

### 需求：导入播放列表

系统必须提供从本地文件导入播放列表的功能，支持JSON、M3U8和PLS三种格式，并自动识别文件格式。

#### 场景：导入JSON格式播放列表
- **当** 用户选择一个JSON格式的播放列表文件
- **那么** 系统必须解析JSON文件并创建新的播放列表
- **并且** 导入的播放列表必须包含所有歌曲和元数据

#### 场景：导入M3U8格式播放列表
- **当** 用户选择一个M3U8格式的播放列表文件
- **那么** 系统必须解析M3U8文件并创建新的播放列表
- **并且** 歌曲的标题和时长信息必须从 `#EXTINF` 行提取

#### 场景：导入PLS格式播放列表
- **当** 用户选择一个PLS格式的播放列表文件
- **那么** 系统必须解析PLS文件并创建新的播放列表
- **并且** 歌曲的标题和时长信息必须从对应字段提取

#### 场景：自动识别文件格式
- **当** 用户选择一个播放列表文件
- **那么** 系统必须根据文件扩展名自动识别文件格式
- **并且** 如果扩展名不匹配实际内容，系统必须显示错误提示

---

### 需求：路径验证

系统必须在导入播放列表时验证所有歌曲的文件路径是否存在。

#### 场景：路径有效
- **当** 导入的播放列表中所有歌曲路径都存在
- **那么** 系统必须正常导入播放列表
- **并且** 显示成功导入的歌曲数量

#### 场景：部分路径无效
- **当** 导入的播放列表中有部分歌曲路径不存在
- **那么** 系统必须导入播放列表，但标记无效路径的歌曲
- **并且** 显示导入结果：有效歌曲数和无效歌曲数

#### 场景：全部路径无效
- **当** 导入的播放列表中所有歌曲路径都不存在
- **那么** 系统必须显示警告消息，提示用户所有歌曲路径无效
- **并且** 询问用户是否仍然导入

---

### 需求：冲突处理

系统必须在导入播放列表时处理播放列表名称冲突，提供跳过、重命名和覆盖选项。

#### 场景：播放列表重名冲突
- **当** 导入的播放列表名称与现有播放列表重复
- **那么** 系统必须显示冲突处理对话框
- **并且** 提供"跳过"、"重命名"、"覆盖"三个选项

#### 场景：选择跳过重名播放列表
- **当** 用户在冲突处理对话框中选择"跳过"
- **那么** 系统必须跳过当前播放列表的导入
- **并且** 继续处理其他播放列表（如果有）

#### 场景：选择重命名播放列表
- **当** 用户在冲突处理对话框中选择"重命名"
- **那么** 系统必须自动生成新的播放列表名称（如"播放列表名 (2)"）
- **并且** 导入重命名后的播放列表

#### 场景：选择覆盖播放列表
- **当** 用户在冲突处理对话框中选择"覆盖"
- **那么** 系统必须显示二次确认对话框
- **并且** 用户确认后，用导入的播放列表替换现有播放列表

#### 场景：批量应用冲突处理策略
- **当** 用户勾选"应用到全部同类冲突"
- **那么** 系统必须对所有相同类型的冲突应用相同的处理策略

---

### 需求：UI交互

系统必须在工具栏操作下拉菜单中提供导出和导入功能入口。

#### 场景：访问导出功能
- **当** 用户点击工具栏的"操作"下拉菜单
- **那么** 菜单必须包含"导出播放列表"选项
- **并且** "导出播放列表"必须包含二级菜单，显示"导出当前播放列表"
- **并且** "导出当前播放列表"必须包含三级菜单，显示JSON、M3U8、PLS格式选项

#### 场景：访问导入功能
- **当** 用户点击工具栏的"操作"下拉菜单
- **那么** 菜单必须包含"导入播放列表"选项
- **并且** 点击"导入播放列表"必须打开文件选择对话框

#### 场景：导出格式选择对话框
- **当** 用户选择"导出当前播放列表"的任意格式
- **那么** 系统必须显示导出格式选择对话框
- **并且** 对话框必须显示三种格式及其说明
- **并且** 默认选中JSON格式

#### 场景：导入结果提示
- **当** 导入完成
- **那么** 系统必须显示导入结果对话框
- **并且** 对话框必须显示成功导入的播放列表数量
- **并且** 如果有路径无效的歌曲，必须显示统计信息

---

### 需求：JSON文件格式

导出的JSON文件必须遵循以下格式规范。

#### 场景：JSON文件结构
- **当** 系统导出JSON格式的播放列表
- **那么** JSON文件必须包含以下字段：
  - `version`: 格式版本号（字符串，如"1.0"）
  - `exportTime`: 导出时间（ISO 8601格式）
  - `exportType`: 导出类型（"current"）
  - `playlists`: 播放列表数组

#### 场景：播放列表对象结构
- **当** 系统导出播放列表
- **那么** 每个播放列表对象必须包含：
  - `name`: 播放列表名称
  - `sortOption`: 排序选项
  - `sortOrder`: 排序顺序
  - `isDefault`: 是否为默认播放列表
  - `tracks`: 歌曲数组

#### 场景：歌曲对象结构
- **当** 系统导出歌曲
- **那么** 每首歌曲对象必须包含：
  - `id`: 唯一标识符（UUID格式）
  - `name`: 文件名
  - `path`: 绝对文件路径
  - `title`: 歌曲标题（如果有）
  - `artist`: 艺术家名称（如果有）
  - `album`: 专辑名称（如果有）
  - `duration`: 时长（秒，如果有）

---

## 非功能需求

### 性能

- 系统必须支持导出和导入包含1000首歌曲的播放列表，操作时间不超过3秒
- 系统必须验证1000条文件路径的有效性，验证时间不超过2秒

### 兼容性

- 导出的M3U8格式必须兼容VLC Media Player、Winamp、Foobar2000等主流播放器
- 导出的PLS格式必须兼容Winamp、Foobar2000等支持PLS的播放器
- 导出的JSON格式必须包含完整的播放列表元数据，支持无损恢复

### 用户体验

- 系统必须在所有操作中提供清晰的进度反馈和错误提示
- 系统必须在导出/导入过程中显示加载状态
- 系统必须在导入冲突时提供直观的冲突处理界面，类似于Windows文件复制冲突对话框

### 可维护性

- 格式转换工具必须独立于UI逻辑，便于后续扩展新格式
- 冲突处理逻辑必须封装为独立的模块，便于测试和维护
- 所有新增代码必须遵循项目的代码规范和架构约定
