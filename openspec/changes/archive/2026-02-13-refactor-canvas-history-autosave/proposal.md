## 为什么

当前画板的历史记录和自动保存功能存在以下问题：

1. **代码耦合严重**：`useHistory.ts` 混合了撤销/恢复历史栈、自动保存定时器、localStorage 持久化等功能，导致单个文件超过 200 行，可维护性差
2. **功能不完整**：历史记录仅存在于内存中，关闭页面后丢失；自动保存使用 localStorage 有 5MB 限制且无版本管理
3. **缺乏错误处理**：部分边界情况（如 Canvas 实例不存在、JSON 解析失败）处理不完善
4. **可扩展性差**：未来如果需要云端同步或版本历史，当前架构难以支持

现在重构是合适的时机，因为画板功能已经相对稳定，可以安全地进行重构而不会影响核心业务逻辑。

## 变更内容

1. **拆分 useHistory.ts**：将历史记录管理、自动保存、存储持久化拆分为独立的模块
2. **新增版本管理**：为自动保存数据添加版本号，支持未来格式迁移
3. **优化存储策略**：使用 Tauri 提供的 store 替代 localStorage 存储画板数据，支持更大容量和持久化存储
4. **增强错误处理**：完善边界情况处理和用户反馈
5. **解耦 Canvas 依赖**：将核心逻辑与 Fabric.js Canvas 实例解耦，提高可测试性

## 功能 (Capabilities)

### 新增功能
- `history-management`: 独立的撤销/恢复历史栈管理模块
- `auto-save`: 独立的自动保存逻辑模块
- `storage-persistence`: 基于 IndexedDB 的持久化存储模块

### 修改功能
- 现有画板功能保持不变，仅重构内部实现

## 影响

- **重构范围**：`src/views/CanvasBoard/hooks/useHistory.ts` 及相关调用代码
- **无破坏性变更**：对外 API 保持兼容
- **无新依赖**：使用浏览器原生 IndexedDB API
