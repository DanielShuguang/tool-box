## 上下文

当前画布拖拽平移功能存在两个核心 bug：
1. **按下空格键时光标无变化**：用户无法感知已进入平移模式
2. **无法正常拖拽**：状态同步问题导致拖拽操作失效

问题根源在于 `CanvasContainer.vue` 中的事件处理逻辑：
- `handleKeyDown` 只设置 `isSpacePressed`，未同步更新 `isPanning` 状态和光标样式
- `handlePan` 函数依赖 `canvasCore.isPanning`，但该状态未正确同步
- 组件内部 `isPanning.value` 和 `canvasCore.isPanning` 存在状态不一致

## 目标 / 非目标

**目标：**
- 修复空格键按下时光标立即变为 `grab`
- 修复按住空格键拖拽可以正确平移画布
- 释放空格键后光标正确恢复

**非目标：**
- 不添加新的功能或交互方式
- 不改变现有的键盘快捷键体系
- 不引入新的外部依赖

## 决策

### 决策 1：统一状态管理

**方案 A：保留双状态（当前实现）**
- 组件内部 `isPanning.value` + `canvasCore.isPanning`
- 缺点：状态同步复杂，容易出现竞态条件

**方案 B：单一状态源**
- 只使用 `canvasCore.isPanning` 作为唯一状态源
- 优点：状态清晰，避免同步问题
- 缺点：需要调整事件处理顺序

**选择：方案 B**

### 决策 2：光标样式更新时机

**方案 A：在 `handleKeyDown` 中直接更新**
- 按下空格时立即更新光标
- 优点：响应及时
- 缺点：可能在不需要的场景（如输入框）触发

**方案 B：按需更新（当前尝试）**
- 只在鼠标按下拖拽时更新
- 缺点：用户无法提前感知平移模式

**选择：方案 A + 输入框保护**
- 按下空格时立即更新光标
- 在 `handleKeyDown` 中添加 `isInputElement` 检查

### 决策 3：事件处理优化

**方案 A：继续使用 window 事件**
- 监听器绑定到 window
- 优点：捕获全局事件
- 缺点：焦点问题可能导致事件丢失

**方案 B：使用 Vue 的 `@keydown` 和 `@keyup`**
- 绑定到组件或 document
- 优点：Vue 生命周期管理更清晰

**选择：方案 A（保持现状）**
- window 事件在当前场景下工作正常
- 仅修复状态同步问题，不改变事件绑定方式

## 风险 / 权衡

| 风险 | 描述 | 缓解措施 |
|------|------|----------|
| 状态同步 | `isSpacePressed` 和 `isPanning` 可能不同步 | 使用单一状态源，统一管理 |
| 焦点问题 | window 事件可能在某些焦点状态下失效 | 添加输入框保护逻辑 |
| 事件冲突 | 与 Fabric.js 的原生事件可能冲突 | 在适当时机阻止 Fabric.js 的事件处理 |

## 迁移计划

1. **修复 `CanvasContainer.vue`**：
   - 重构事件处理逻辑，统一状态管理
   - 按下空格键时立即更新光标样式
   - 确保 `isPanning` 状态正确同步

2. **验证测试**：
   - 手动测试所有平移场景
   - 确保不影响其他画布操作

3. **代码清理**：
   - 移除未使用的状态变量
   - 简化代码逻辑
